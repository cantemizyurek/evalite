---
title: Concurrency
---

import { Steps } from "@astrojs/starlight/components";

When running evals with large datasets, you may want to control how many test cases run in parallel to optimize performance and manage API rate limits.

Since **Evalite is based on Vitest**, it respects Vitest's concurrency configuration, giving you full control over parallel execution.

## Configuring maxConcurrency

By default, Vitest runs tests with a concurrency limit. For large datasets, you can increase this limit to run more tests in parallel:

<Steps>

1. Create a `vite.config.ts` file in your project root (or update it if it already exists):

   ```ts
   // vite.config.ts

   import { defineConfig } from "vite";

   export default defineConfig({
     test: {
       maxConcurrency: 100, // Run up to 100 tests in parallel
     },
   });
   ```

2. Run your evals as usual:

   ```bash
   evalite
   ```

   Or in watch mode:

   ```bash
   evalite watch
   ```

</Steps>

## Performance Impact

Increasing `maxConcurrency` can significantly improve performance for large datasets. For example, with a dataset of ~300 items:

- **Default concurrency**: ~60 seconds
- **High concurrency (100+)**: ~9 seconds

The optimal value depends on:

- **Your dataset size**: Larger datasets benefit more from higher concurrency
- **API rate limits**: Stay within your LLM provider's rate limits
- **System resources**: More concurrent requests use more memory and network connections

## Relationship with Vitest

Evalite runs your `.eval.ts` files using Vitest under the hood. Each data point in your eval becomes a separate Vitest test case, which means:

- All Vitest configuration options work with Evalite
- You can use any Vitest features in your evals
- The `vite.config.ts` file controls both test and eval behavior

For more Vitest configuration options, see the [Vitest documentation](https://vitest.dev/config/).

## Additional Configuration

You can pass a custom config file path using Vitest's standard options:

```bash
evalite --config=./custom-vitest.config.ts
```

This is particularly useful in monorepos where you want different concurrency settings for different packages.

## Tips for Large Datasets

When working with large datasets:

1. **Start conservative**: Begin with moderate concurrency (e.g., 50) and increase gradually
2. **Monitor rate limits**: Watch for 429 errors from your LLM provider
3. **Use caching**: Implement a caching layer to avoid re-running expensive LLM calls during development
4. **Test in CI**: Lower concurrency in CI environments to avoid overwhelming shared resources
